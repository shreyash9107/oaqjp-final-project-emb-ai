"""
Server module for Emotion Detection web application.

This module deploys the Emotion Detection package using Flask.
It exposes an endpoint to analyze user text and return emotion results.
"""

from flask import Flask, render_template, request
from EmotionDetection import emotion_detector

app = Flask(__name__)


@app.route("/")
def index():
    """
    Render the home page of the application.

    Returns:
        HTML template: index page.
    """
    return render_template("index.html")


@app.route("/emotionDetector")
def emotion_detector_route():
    """
    Analyze the text entered by the user and return emotion results.

    Returns:
        str: Formatted emotion analysis result or error message.
    """
    text_to_analyse = request.args.get("textToAnalyze")

    # Handle blank input
    if not text_to_analyse or text_to_analyse.strip() == "":
        return "Invalid text! Please try again!"

    response = emotion_detector(text_to_analyse)

    # Handle API returning None values
    if response["dominant_emotion"] is None:
        return "Invalid text! Please try again!"

    anger = response["anger"]
    disgust = response["disgust"]
    fear = response["fear"]
    joy = response["joy"]
    sadness = response["sadness"]
    dominant_emotion = response["dominant_emotion"]

    result = (
        "For the given statement, the system response is "
        f"'anger': {anger}, "
        f"'disgust': {disgust}, "
        f"'fear': {fear}, "
        f"'joy': {joy} and "
        f"'sadness': {sadness}. "
        f"The dominant emotion is {dominant_emotion}."
    )

    return result


if __name__ == "__main__":
    app.run(host="0.0.0.0", port=5001)
